image: docker:stable

services:
  - docker:dind

stages:
  - build
  - publish

before_script:
  - docker login -u $CI_DEPLOY_USER -p $CI_DEPLOY_PASSWORD $CI_REGISTRY

build:
  stage: build
  script: docker build --target admin-http --tag deslee/cms-admin-http:$CI_COMMIT_REF_SLUG .

publish:
  stage: publish
  script: docker publish deslee/cms-admin-http:$CI_COMMIT_REF_SLUG